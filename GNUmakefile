################################################################################
ARCH              = $(shell uname -m)
OS                = $(shell uname -s | tr '[A-Z]' '[a-z]')
TARGET            = $(HOME)/.xmonad/xmonad-$(ARCH)-$(OS)
SRC               = $(shell find . -type f -name '*.hs')
XMONAD            = .stack-work/install/x86_64-linux/lts-3.8/7.10.2/bin/xmonad
XMONADRC          = $(HOME)/.local/bin/xmonadrc

################################################################################
.PHONEY: all install restart clean realclean

################################################################################
all: $(XMONADRC)

################################################################################
install: $(TARGET)

################################################################################
restart: install
	$(XMONAD) --restart

################################################################################
clean:
	stack clean
	rm -rf $(XMONADRC)

################################################################################
realclean:
	rm -rf .stack-work
	rm -rf $(XMONADRC)

################################################################################
$(XMONADRC): $(SRC)
	stack install

################################################################################
$(TARGET): $(XMONADRC)
	mkdir -p $(dir $@)
	if [ -r $@ ]; then mv $@ $@.prev; fi
	cp -p $< $@
